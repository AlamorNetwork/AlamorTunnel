{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-white"><i class="fas fa-project-diagram me-2"></i>Active Tunnels</h2>
    <a href="{{ url_for('dashboard.index') }}" class="btn btn-glass shadow-sm">
        <i class="fas fa-plus me-2"></i>Create New
    </a>
</div>

<div class="glass-card p-0 overflow-hidden">
    <div class="table-responsive">
        <table class="table table-glass align-middle mb-0">
            <thead>
                <tr>
                    <th class="ps-4 py-3">ID</th>
                    <th class="py-3">PROTOCOL</th>
                    <th class="py-3">TUNNEL PORT</th>
                    <th class="py-3">CONFIGURATION</th>
                    <th class="text-end pe-4 py-3">CONTROLS</th>
                </tr>
            </thead>
            <tbody>
                {% for tunnel in tunnels %}
                <tr>
                    <td class="ps-4 fw-bold text-muted">#{{ tunnel.id }}</td>
                    <td>
                        {% if 'hysteria' in tunnel.transport %}
                            <span class="badge bg-warning text-dark px-3 py-2 rounded-pill"><i class="fas fa-bolt me-1"></i>HYSTERIA 2</span>
                        {% elif 'rathole' in tunnel.transport %}
                            <span class="badge bg-success px-3 py-2 rounded-pill"><i class="fas fa-shield-alt me-1"></i>RATHOLE</span>
                        {% elif 'slipstream' in tunnel.transport %}
                            <span class="badge bg-info text-dark px-3 py-2 rounded-pill"><i class="fas fa-wind me-1"></i>SLIPSTREAM</span>
                        {% else %}
                            <span class="badge bg-primary px-3 py-2 rounded-pill"><i class="fas fa-network-wired me-1"></i>BACKHAUL</span>
                        {% endif %}
                    </td>
                    <td class="font-monospace text-accent fs-5">{{ tunnel.port }}</td>
                    <td>
                        <div class="input-group input-group-sm" style="max-width: 250px;">
                            <span class="input-group-text bg-transparent border-secondary text-white"><i class="fas fa-key"></i></span>
                            <input type="text" class="form-control bg-transparent text-white-50" value="{{ tunnel.token }}" readonly id="tok-{{tunnel.id}}">
                            <button class="btn btn-outline-light" onclick="copyToken('tok-{{tunnel.id}}')"><i class="fas fa-copy"></i></button>
                        </div>
                    </td>
                    <td class="text-end pe-4">
                        <a href="{{ url_for('tunnels.edit_tunnel', tunnel_id=tunnel.id) }}" class="btn btn-sm btn-outline-info rounded-circle" style="width:32px;height:32px;padding:4px;" title="Details"><i class="fas fa-info"></i></a>
                        <a href="{{ url_for('tunnels.delete_tunnel', tunnel_id=tunnel.id) }}" class="btn btn-sm btn-outline-danger rounded-circle ms-2" style="width:32px;height:32px;padding:4px;" onclick="return confirm('Stop and delete this tunnel?')" title="Delete"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center py-5">
                        <i class="fas fa-ghost fa-3x text-muted mb-3 opacity-50"></i>
                        <p class="text-muted">No tunnels running. Start one from Dashboard.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function copyToken(id) {
    var copyText = document.getElementById(id);
    copyText.select();
    navigator.clipboard.writeText(copyText.value);
}
</script>
{% endblock %}