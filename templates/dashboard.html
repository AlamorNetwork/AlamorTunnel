<div class="modal fade" id="backhaulModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg"> <form action="{{ url_for('tunnels.install_backhaul') }}" method="POST" class="modal-content glass-card border-0 p-0">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold text-primary"><i class="fas fa-network-wired me-2"></i>Backhaul Enterprise</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                
                <h6 class="text-accent text-uppercase mb-3 small fw-bold">Basic Configuration</h6>
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label">Transport Protocol</label>
                        <select name="transport" class="form-select">
                            <option value="tcp" selected>TCP (Recommended)</option>
                            <option value="tcpmux">TCP Mux</option>
                            <option value="ws">WebSocket</option>
                            <option value="wss">WebSocket Secure (TLS)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Tunnel Port</label>
                        <input name="tunnel_port" type="number" class="form-control" placeholder="3080" required>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Port Forwarding Rules</label>
                        <textarea name="port_rules" class="form-control font-monospace" rows="3" placeholder="443&#10;8080=8080&#10;443-600=1.1.1.1:5201"></textarea>
                        <div class="form-text text-white-50">One rule per line. Supports ranges and redirection.</div>
                    </div>
                </div>

                <div class="text-center mb-3">
                    <button class="btn btn-sm btn-outline-light rounded-pill px-4" type="button" data-bs-toggle="collapse" data-bs-target="#advSettings">
                        <i class="fas fa-sliders-h me-2"></i>Advanced Settings
                    </button>
                </div>

                <div class="collapse" id="advSettings">
                    <div class="glass-card bg-black bg-opacity-25 p-3 border-0">
                        
                        <h6 class="text-white-50 small fw-bold mb-3 border-bottom border-secondary pb-1">Network Optimization</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label class="form-label small">Keepalive (s)</label>
                                <input type="number" name="keepalive_period" class="form-control form-control-sm" value="75">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Heartbeat (s)</label>
                                <input type="number" name="heartbeat" class="form-control form-control-sm" value="40">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Mux Concurrency</label>
                                <input type="number" name="mux_con" class="form-control form-control-sm" value="8">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Channel Size</label>
                                <input type="number" name="channel_size" class="form-control form-control-sm" value="2048">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">MSS</label>
                                <input type="number" name="mss" class="form-control form-control-sm" value="1360">
                            </div>
                        </div>

                        <h6 class="text-white-50 small fw-bold mb-3 border-bottom border-secondary pb-1">Buffer Sizes (Bytes)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label small text-info">Server Rcv Buf</label>
                                <input type="number" name="so_rcvbuf" class="form-control form-control-sm" value="4194304">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-info">Server Snd Buf</label>
                                <input type="number" name="so_sndbuf" class="form-control form-control-sm" value="1048576">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-warning">Client Rcv Buf</label>
                                <input type="number" name="client_so_rcvbuf" class="form-control form-control-sm" value="1048576">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-warning">Client Snd Buf</label>
                                <input type="number" name="client_so_sndbuf" class="form-control form-control-sm" value="4194304">
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="nodelay" checked>
                                    <label class="form-check-label small">TCP NoDelay</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="skip_optz" checked>
                                    <label class="form-check-label small">Skip Optimizations</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="sniffer">
                                    <label class="form-check-label small">Enable Sniffer</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="accept_udp">
                                    <label class="form-check-label small">Accept UDP</label>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>

            </div>
            <div class="modal-footer border-0">
                <button class="btn btn-glass w-100">Deploy Configuration</button>
            </div>
        </form>
    </div>
</div>